<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Coast2Coast 2025</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            margin: 0;
            background: #0b1020;
            color: #f5f6fa;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background: #111731;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        h1 {
            margin: 0;
            font-size: 1.2rem;
        }
        .date-display-top {
            font-size: 1rem;
            font-weight: bold;
            text-align: center;
            margin-top: 0.5rem;
            color: #9fb1d8;
        }
        .wrap {
            padding: 1rem;
            flex-grow: 1;
        }
        h2 {
            font-size: 1.1rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #2a3561;
            padding-bottom: 0.25rem;
        }
        .card {
            background: #1a2142;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 0.75rem;
            border: 1px solid #2a3561;
            position: relative;
        }
        .time {
            font-weight: bold;
            font-size: 1rem;
        }
        .title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 0.25rem;
        }
        .details {
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        .detail-row {
            margin-bottom: 0.25rem;
        }
        .detail-label {
            color: #9fb1d8;
            font-weight: 600;
            margin-right: 0.5rem;
        }
        .clickable-location {
            color: #6da2f8;
            text-decoration: underline;
            cursor: pointer;
        }
        .empty {
            padding: 1rem;
            border: 1px dashed #2a3561;
            border-radius: 12px;
            text-align: center;
            color: #9fb1d8;
        }
        .current {
            border: 2px solid #4a90e2;
            box-shadow: 0 0 8px #4a90e2;
        }
        .checkbox {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
        }
        input[type="checkbox"] {
            transform: scale(1.3);
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1rem;
            background: #111731;
            position: sticky;
            bottom: 0;
            z-index: 9;
            border-top: 1px solid #2a3561;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
        }
        .nav-button {
            background: #2a3561;
            color: #f5f6fa;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }
        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .date-display-bottom {
            font-size: 1.1rem;
            font-weight: bold;
            flex-grow: 1;
            text-align: center;
        }
        .date-display-bottom.hidden {
            display: none;
        }
        .countdown-container {
            text-align: center;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .countdown-message {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 1rem;
        }
        #countdownTimer {
            font-size: 2.5rem;
            font-weight: bold;
            color: #f5f6fa;
            margin-bottom: 1.5rem;
            background: #1a2142;
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid #2a3561;
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.5);
        }
        .countdown-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        .countdown-button:hover {
            background: #3973b7;
        }
    </style>
</head>
<body>
    <header>
        <h1>Coast2Coast 2025</h1>
        <div id="dateDisplayTop" class="date-display-top"></div>
    </header>
    <div id="appContainer" class="wrap">
        <div id="itineraryView">
            <div id="list"></div>
        </div>
        <div id="countdownView" style="display:none;">
            <div class="countdown-container">
                <div class="countdown-message">Countdown to start</div>
                <div id="countdownTimer"></div>
                <button id="backBtn" class="countdown-button">Back to Itinerary</button>
            </div>
        </div>
    </div>
    <div class="navigation">
        <button id="prevBtn" class="nav-button">‚¨ÖÔ∏è</button>
        <button id="todayBtn" class="nav-button">Today</button>
        <button id="nextBtn" class="nav-button">‚û°Ô∏è</button>
    </div>
    <script>
        let grouped = new Map();
        let allDates = [];
        let events = [];
        let currentIndex = 0;
        let countdownInterval;

        /**
         * Parses a date string in Day/Month/Year format.
         * @param {string} dateStr - The date string to parse.
         * @returns {Date|null} The parsed Date object or null if invalid.
         */
        function parseDateDMY(dateStr) {
            if (!dateStr) return null;
            const [d, m, y] = dateStr.split("/").map(x => parseInt(x, 10));
            if (!d || !m || !y) return null;
            return new Date(y, m - 1, d);
        }

        /**
         * Formats a Date object into a DD-MM-YY string.
         * @param {Date} d - The Date object to format.
         * @returns {string} The formatted date string.
         */
        function formatDateDDMMYY(d) {
            const dd = String(d.getDate()).padStart(2, '0');
            const mm = String(d.getMonth() + 1).padStart(2, '0');
            const yy = String(d.getFullYear()).slice(-2);
            return `${dd}-${mm}-${yy}`;
        }
        
        /**
         * Formats a date string for display (e.g., "Monday, August 25, 2025").
         * @param {string} dStr - The date string in DD-MM-YY format.
         * @returns {string} The user-friendly date string.
         */
        function formatDateForDisplay(dStr) {
            const [dd, mm, yy] = dStr.split('-');
            const date = new Date(`20${yy}`, mm - 1, dd);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        /**
         * Converts CSV text into an array of row arrays.
         * @param {string} text - The CSV text.
         * @returns {string[][]} An array of rows.
         */
        function csvToRows(text) {
            const lines = text.trim().split(/\r?\n/);
            return lines.map(line => line.split(","));
        }

        /**
         * Parses event data from a custom CSV format.
         * @param {string[][]} rows - The CSV rows.
         * @returns {Array<Object>} An array of event objects.
         */
        function parseEventsFromCustomCSV(rows) {
            const evts = [];
            for (let i = 1; i < rows.length; i++) {
                const r = rows[i];
                if (!r[0]) continue;
                const dt = parseDateDMY(r[0].trim());
                if (!dt) continue;
                const dateStr = formatDateDDMMYY(dt);
                const dep = r[5] || "";
                const arr = r[6] || "";
                const from = r[2] || "";
                const to = r[3] || "";
                const activity = from && to ? `${from} ‚Üí ${to}` : (from || to || "Activity");
                
                const details = {};
                if (from) details['From'] = from;
                if (to) details['To'] = to;
                if (dep) details['Departure Time'] = dep;
                if (arr) details['Arrival Time'] = arr;
                
                evts.push({ date: dateStr, time: dep || arr || "", activity, details, id: `${dateStr}-${i}` });
            }
            return evts;
        }

        /**
         * Groups events by date.
         * @param {Array<Object>} events - The list of events.
         * @returns {Map<string, Array<Object>>} A map with dates as keys and event arrays as values.
         */
        function groupByDate(events) {
            const map = new Map();
            for (const e of events) {
                if (!map.has(e.date)) map.set(e.date, []);
                map.get(e.date).push(e);
            }
            return map;
        }

        /**
         * Checks if an event is currently happening or will happen soon.
         * @param {Object} evt - The event object.
         * @returns {boolean} True if the event is a current or upcoming one.
         */
        function isNowOrNext(evt) {
            if (!evt.time) return false;
            const [hh, mm] = evt.time.split(":").map(x => parseInt(x, 10));
            if (isNaN(hh)) return false;
            const now = new Date();
            const [dd, mmDate, yy] = evt.date.split('-').map(x => parseInt(x, 10));
            const evtDate = new Date(2000 + yy, mmDate - 1, dd, hh, mm || 0);
            const diff = evtDate - now;
            return diff >= 0 && diff < 2 * 60 * 60 * 1000;
        }

        /**
         * Opens the device's default map app with directions to a specified destination.
         * @param {string} destination - The name of the destination.
         */
        function openInMaps(destination) {
            const url = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(destination)}`;
            window.open(url, '_blank');
        }

        /**
         * Renders the itinerary for a specific date.
         * @param {string} dateStr - The date string to render.
         */
        function renderDay(dateStr) {
            const list = document.getElementById('list');
            list.innerHTML = '';
            
            const evts = grouped.get(dateStr) || [];
            if (evts.length === 0) {
                list.innerHTML = `<div class="empty">No events scheduled for this day.</div>`;
                return;
            }

            const doneIds = JSON.parse(localStorage.getItem('doneIds') || '[]');
            const remaining = evts.filter(e => !doneIds.includes(e.id));
            
            if (remaining.length === 0) {
                list.innerHTML = `<div class="empty">All events for this day are complete! üéâ</div>`;
                return;
            }

            for (const e of remaining) {
                const card = document.createElement('div');
                card.className = 'card';
                if (isNowOrNext(e)) card.classList.add('current');

                const t = document.createElement('div');
                t.className = 'time';
                t.textContent = e.time || 'All day';

                const title = document.createElement('div');
                title.className = 'title';
                title.textContent = e.activity;

                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'details';

                // Make "From" location clickable
                if(e.details['From']) {
                    const fromRow = document.createElement('div'); 
                    fromRow.className = 'detail-row';
                    fromRow.innerHTML = `<span class="detail-label">From:</span> <span class="clickable-location">${e.details['From']}</span>`;
                    fromRow.querySelector('.clickable-location').addEventListener('click', () => openInMaps(e.details['From']));
                    detailsDiv.appendChild(fromRow);
                }
                // Make "To" location clickable
                if(e.details['To']) {
                    const toRow = document.createElement('div'); 
                    toRow.className = 'detail-row';
                    toRow.innerHTML = `<span class="detail-label">To:</span> <span class="clickable-location">${e.details['To']}</span>`;
                    toRow.querySelector('.clickable-location').addEventListener('click', () => openInMaps(e.details['To']));
                    detailsDiv.appendChild(toRow);
                }
                
                if(e.details['Departure Time']) {
                    const depRow = document.createElement('div'); depRow.className = 'detail-row';
                    depRow.innerHTML = `<span class="detail-label">Departure:</span> ${e.details['Departure Time']}`;
                    detailsDiv.appendChild(depRow);
                }
                if(e.details['Arrival Time']) {
                    const arrRow = document.createElement('div'); arrRow.className = 'detail-row';
                    arrRow.innerHTML = `<span class="detail-label">Arrival:</span> ${e.details['Arrival Time']}`;
                    detailsDiv.appendChild(arrRow);
                }

                const cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.className = 'checkbox';
                cb.onchange = () => {
                    const ids = JSON.parse(localStorage.getItem('doneIds') || '[]');
                    if (cb.checked && !ids.includes(e.id)) ids.push(e.id);
                    localStorage.setItem('doneIds', JSON.stringify(ids));
                    renderDay(dateStr);
                };
                card.appendChild(cb);
                card.appendChild(t);
                card.appendChild(title);
                card.appendChild(detailsDiv);
                list.appendChild(card);
            }
        }

        /**
         * Displays the countdown timer view.
         */
        function showCountdown() {
            document.getElementById('itineraryView').style.display = 'none';
            document.getElementById('countdownView').style.display = 'block';
            document.getElementById('dateDisplayTop').style.display = 'none';
            clearInterval(countdownInterval);
            
            const firstDate = new Date(`20${allDates[0].slice(-2)}`, allDates[0].slice(3, 5) - 1, allDates[0].slice(0, 2));
            
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = firstDate.getTime() - now;

                if (distance < 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdownTimer').innerHTML = "The trip has begun!";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('countdownTimer').innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        }

        /**
         * Displays the itinerary view.
         */
        function showItinerary() {
            clearInterval(countdownInterval);
            document.getElementById('itineraryView').style.display = 'block';
            document.getElementById('countdownView').style.display = 'none';
            document.getElementById('dateDisplayTop').style.display = 'block';
            updateUI();
        }

        /**
         * Updates the UI with the correct date and buttons state.
         */
        function updateUI() {
            const dateStr = allDates[currentIndex];
            document.getElementById('dateDisplayTop').textContent = formatDateForDisplay(dateStr);
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            document.getElementById('nextBtn').disabled = currentIndex === allDates.length - 1;
            renderDay(dateStr);
        }

        /**
         * Finds the index of the current date in the allDates array.
         * @returns {number} The index, or -1 if not found.
         */
        function findTodayIndex() {
            const today = new Date();
            const todayFormatted = formatDateDDMMYY(today);
            return allDates.indexOf(todayFormatted);
        }

        /**
         * Initializes the application by fetching data and setting up event listeners.
         */
        async function init() {
            try {
                // Read the itinerary data from the local CSV file using the content_fetcher tool.
                const txt = `,,,,,,,,,,,,,,By Locations,,,,,,Sunrise,Sunset,Low,High ,Avg
Date,Day,From,To,Mode,Departure,Arrival,Duration,Distance (miles),To-do,,,Modes,,Date,Day,Location,,,LV,06:15,16:34,8.5¬∞C,19.3¬∞C,13.5¬∞C
12/11/2025,Wednesday,Poole,Heathrow,Car,11:00,13:00,02:00,95.7,,,,Plane,,12/11/2025,Wednesday,UK ‚Üí LV,,,SF,06:50,16:57,9.0¬∞C,17.1¬∞C,12.4¬∞C
12/11/2025,Wednesday,Heathrow,Harry Reid Airport,Plane,16:05,18:50,10:45,5229,,,,Car,,13/11/2025,Thursday,LV,,,NY,06:46,16:35,4.4¬∞C,11.9¬∞C,7.7¬∞C
12/11/2025,Wednesday,Harry Reid Airport,Park MGM,Uber,19:50,20:00,00:10,2.9,,,,Foot,,14/11/2025,Friday,LV,,,,,,,,
12/11/2025,Wednesday,Park MGM,Neon Museum,Uber,,21:00,,7,Old Neon Signs (last admission 9pm),,,Tram\\Bus,,15/11/2025,Saturday,LV ‚Üí SF,,,,,,,,
12/11/2025,Wednesday,Neon Museum,Fremont Street,Uber,,,,1,pm - 9pm,,,Monorail,,16/11/2025,Sunday,SF,,,,,,,,
12/11/2025,Wednesday,Fremont Street,Mob Museum Speakeasy,Foot,,,,0.3,https://youtu.be/rhifA3rfQLU,,,Uber,,17/11/2025,Monday,SF,,,,,,,,
12/11/2025,Wednesday,Mob Museum Speakeasy,Continer Park,Foot,,,,0.6,11am - 11pm,,,Subway,,18/11/2025,Tuesday,LV ‚Üí SF,,,,,,,,
12/11/2025,Wednesday,Container Park,Park MGM,Uber,,,,5.4,11:30am - 11pm,,,Train,,19/11/2025,Wednesday,NY,,,,,,,,
13/11/2025,Thursday,Park MGM,Duck Donuts,Foot,07:30,08:00,00:25,1.1,Breakfast Donuts,,,Waymo,,20/11/2025,Thursday,NY,,,,,,,,
13/11/2025,Thursday,Duck Donuts,The Venician,Foot,,09:30,,0.7,Gondoliers singing,,,BART,,21/11/2025,Friday,NY,,,,,,,,
13/11/2025,Thursday,The Venetian,,,,,,,9:45am & 4:20pm,,,Yellow Taxi,,22/11/2025,Saturday,NY ‚Üí UK,,,,,,,,
13/11/2025,Thursday,The Venetian,Casino Royale,Foot,,,,0.2,Cheap food,,,Ferry,,23/11/2025,Sunday,UK ,,,,,,,,
13/11/2025,Thursday,Casino Royale,Linq Boulevard ,Foot,,,,0.2,Shops & food,,,Bike,,,,,,,,,,,,
13/11/2025,Thursday,Linq Boulevard ,The Sphere,Foot,,,,0.9,View from Sands Ave,,,,,,,,,,,,,,,
13/11/2025,Thursday,The Sphere,Caesar's Palace,Foot,,,,1,Forum shops,,,,,,,,,,,,,,,
13/11/2025,Thursday,Caesar's Palace,Bellagio,Foot,,,,0.4,Fountains and Gardens,,,,,,,,,,,,,,,
13/11/2025,Thursday,Bellagio,Park MGM,Tram\\Bus,20:30,,,1,,,,,,,,,,,,,,,,
13/11/2025,Thursday,Park MGM,Tilted Kilt,Foot,,,,1.5,Dinner,,,,,,,,,,,,,,,
13/11/2025,Thursday,Tilted Kilt,Park MGM,Foot,,,,1.5,11am - 1am,,,,,,,,,,,,,,,
14/11/2025,Friday,Park MGM,IHOP,Uber,,,,4.3,Breakfast,,,,,,,,,,,,,,,
14/11/2025,Friday,IHOP,Walmart,Foot,,,,0.4,24hrs,,,,,,,,,,,,,,,
14/11/2025,Friday,Walmart,Park MGM,Uber,,,,4.2,6am - 11pm,,,,,,,,,,,,,,,
14/11/2025,Friday,Park MGM,Excalibur,Foot,,,,0.5,,,,,,,,,,,,,,,,
14/11/2025,Friday,Excalibur,Luxor,Foot,,,,0.2,,,,,,,,,,,,,,,,
14/11/2025,Friday,Luxor,MGM Grand,Foot,,,,0.6,,,,,,,,,,,,,,,,
14/11/2025,Friday,MGM Grand,Planet Hollywood,Foot,,,,0.6,Lunch,,,,,,,,,,,,,,,
14/11/2025,Friday,Planet Hollywood,Paris,Foot,,,,0.2,,,,,,,,,,,,,,,,
14/11/2025,Friday,Paris,Park MGM,Foot,,,,1,,,,,,,,,,,,,,,,
14/11/2025,Friday,Park MGM,Mandalay Bay,Foot,,,,1,Speakeasy Drinks,,,,,,,,,,,,,,,
15/11/2025,Saturday,Park MGM,Harry Reid Airport,Uber,10:00,10:10,00:10,2.5,,,,,,,,,,,,,,,,
15/11/2025,Saturday,Harry Reid Airport,San Francisco Airport,Plane,12:12,14:05,01:53,555,,,,,,,,,,,,,,,,
15/11/2025,Saturday,San Francisco Airport,Powell Street BART,BART,14:35,15:05,00:30,15,,,,,,,,,,,,,,,,
15/11/2025,Saturday,Powell Street BART,Hotel Emblem,Foot,15:05,15:20,00:15,0.5,,,,,,,,,,,,,,,,
15/11/2025,Saturday,Hotel Emblem,Dragon Gate,Foot,,,,0.3,,,,,,,,,,,,,,,,
15/11/2025,Saturday,Dragon Gate,Nintendo Store,Foot,,,,0.4,,,,,,,,,,,,,,,,
15/11/2025,Saturday,Nintendo Store,Union Square,Foot,20:00,,,0.1,10am - 8pm,,,,,,,,,,,,,,,
15/11/2025,Saturday,Union Square,Apple Store,Foot,20:00,,,0,,,,,,,,,,,,,,,,
15/11/2025,Saturday,Apple Store,Cheesecake Factory,Foot,23:00,,,0.2,10am - 8pm,,,,,,,,,,,,,,,
15/11/2025,Saturday,Cheesecake Factory,Hotel Emblem,Foot,,,,0.3,Dinner,,,,,,,,,,,,,,,
16/11/2025,Sunday,Hotel Emblem,Pier 33,Foot,07:19,07:55,00:36,1.6,,,,,,,,,,,,,,,,
16/11/2025,Sunday,Pier 33,Alcatraz,Ferry,08:40,09:00,,2.3,8:40am Ferry,,,,,,,,,,,,,,,
16/11/2025,Sunday,Alcatraz,Pier 33,Ferry,11:40,12:00,,2.3,Prison,,,,,,,,,,,,,,,
16/11/2025,Sunday,Pier 33,Pier 39,Foot,,,,0.3,,,,,,,,,,,,,,,,
16/11/2025,Sunday,Pier 39,Bubba Gump,Foot,,,,0.2,Lunch,,,,,,,,,,,,,,,
16/11/2025,Sunday,Bubba Gump,Fishermans Wharf,Foot,,,,0.3,,,,,,,,,,,,,,,,
16/11/2025,Sunday,Fishermans Wharf,The Ferry Building,Foot,,,,1.5,If running out of time go to Cable Car Museum instead,,,,,,,,,,,,,,,
16/11/2025,Sunday,The Ferry Building,Hotel Emblem,Foot,,,,1.2,,,,,,,,,,,,,,,,
16/11/2025,Sunday,Hotel Emblem,Cable Car Museum,Foot,,,,0.4,,,,,,,,,,,,,,,,
16/11/2025,Sunday,Cable Car Museum,Golden Gate Fortune Cookie Factory,Foot,,,,0.3,10am - 5pm,,,,,,,,,,,,,,,
16/11/2025,Sunday,Golden Gate Fortune Cookie Factory,Hotel Emblem ,Foot,,,,,,,,,,,,,,,,,,,,
17/11/2025,Monday,Hotel Emblem ,Lori's Diner,Foot,07:00,,,,Breakfast in 50's diner,,,,,,,,,,,,,,,
17/11/2025,Monday,Lori's Diner,Grace Cathederal,Foot,,,,,,,,,,,,,,,,,,,,
17/11/2025,Monday,Grace Cathederal,Lombard Street,Tram\\Bus,,,,,Wiggly Road,,,,,,,,,,,,,,,
17/11/2025,Monday,Lombard Street,Golden Gate Bridge Welcome Center,Tram\\Bus,,,,,Morning View of Bridge,,,,,,,,,,,,,,,
17/11/2025,Monday,Golden Gate Bridge Welcome Center,Palace of Fine Arts,Tram\\Bus,,,,,Posh Artistic Park,,,,,,,,,,,,,,,
17/11/2025,Monday,Palace of Fine Arts,Fillmore St,Foot,,,,,I love you!!!,,,,,,,,,,,,,,,
17/11/2025,Monday,Fillmore St,Grove Street\\Painted Ladies,Tram\\Bus,,,,,Coloured Houses,,,,,,,,,,,,,,,
17/11/2025,Monday,Grove Street\\Painted Ladies,Hotel Emblem,Waymo,,,,,Afternoon Nap,,,,,,,,,,,,,,,
17/11/2025,Monday,Hotel Emblem,Rincon Park,Tram\\Bus,,,,,Bow & Arrow,,,,,,,,,,,,,,,
17/11/2025,Monday,Rincon Park,The Ferry Building/Fisherman's Wharf,Tram\\Bus,,,,,Dinner @ Pier Market (Pier 39),,,,,,,,,,,,,,,
17/11/2025,Monday,The Ferry Building/Fisherman's Wharf,Hotel Emblem,Tram\\Bus,,,,,,,,,,,,,,,,,,,,
18/11/2025,Tuesday,Hotel Emblem,Powell Street BART,Foot,07:40,07:55,00:15,15,,,,,,,,,,,,,,,,
18/11/2025,Tuesday,Powell Street BART,San Francisco Airport,BART,07:55,08:25,00:30,,,,,,,,,,,,,,,,,
18/11/2025,Tuesday,San Francisco Airport,JFK Airport,Plane,11:00,19:35,05:35,2980,,,,,,,,,,,,,,,,
18/11/2025,Tuesday,JFK Airport,The Lexington,Yellow Taxi,20:05,21:05,01:00,14.5,,,,,,,,,,,,,,,,
18/11/2025,Tuesday,The Lexington,Foxy John's Bar,Foot,21:00,,,0.1,Dinner,,,,,,,,,,,,,,,
18/11/2025,Tuesday,Foxy John's Bar,The Lexington,Foot,,,,0.1,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,The Lexington,Flatiron Building,Foot,08:30,,,0.7,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Flatiron Building,Harry Potter Store,Foot,,,,0,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Harry Potter Store,Empire State Building,Foot,,09:45,,0.6,10am - 9pm,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Empire State Building,New York Public Library,Foot,,,,0.4,10am tour,,,,,,,,,,,,,,,
19/11/2025,Wednesday,New York Public Library,Grand Central Terminal,Bike,,,,0.3,10am - 8pm,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Grand Central Terminal,Chrysler Building,Foot,,,,0.1,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Chrysler Building,Rockefeller Center,Foot,,,,0.6,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Rockefeller Center,Nintendo Store,Foot,,,,0,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Nintendo Store,Lego Store,Foot,,,,0,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Lego Store,Radio City Music Hall,Foot,,,,0.2,10am - 9pm,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Radio City Music Hall,Times Square,Foot,,,,0.3,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,Times Square,McGee's Pub,Foot,,,,0.4,,,,,,,,,,,,,,,,
19/11/2025,Wednesday,McGee's Pub,The Lexington,Bike,,20:00,,1.1,8pm reservation ,,,,,,,,,,,,,,,
20/11/2025,Thursday,The Lexington,Leo's Bagels,Subway,07:00,,00:30,4.2,,,,,,,,,,,,,,,,
20/11/2025,Thursday,Leo's Bagels,Battery Park,Foot,,,,0.5,6am - 4pm,,,,,,,,,,,,,,,
20/11/2025,Thursday,Battery Park,Statue of Liberty,Ferry,09:00,,,,8:45am ferry,,,,,,,,,,,,,,,
20/11/2025,Thursday,Statue of Liberty,Battery Park,Ferry,,,,,,,,,,,,,,,,,,,,
20/11/2025,Thursday,Battery Park,One World Trade Center,Foot,,,,0.6,,,,,,,,,,,,,,,,
20/11/2025,Thursday,One World Trade Center,Hook & Ladder 8,Foot,,,,0.7,,,,,,,,,,,,,,,,
20/11/2025,Thursday,Hook & Ladder 8,Brooklyn Bridge,Bike,,,,1.1,,,,,,,,,,,,,,,,
20/11/2025,Thursday,Brooklyn Bridge,Washington & Water Street,Foot,,,,1,,,,,,,,,,,,,,,,
20/11/2025,Thursday,Washington & Water Street,Pebble Beach,Foot,,,,0.1,,,,,,,,,,,,,,,,
20/11/2025,Thursday,Pebble Beach,The Lexington,Subway,,,,5.4,,,,,,,,,,,,,,,,
21/11/2025,Friday,The Lexington,Trump Tower,Foot,,,,0.7,,,,,,,,,,,,,,,,
21/11/2025,Friday,Trump Tower,55 Central Park West (Ghostbusters),Bike,,,,1.2,,,,,,,,,,,,,,,,
21/11/2025,Friday,55 Central Park West (Ghostbusters),The Dakota,Bike,,,,0.4,,,,,,,,,,,,,,,,
21/11/2025,Friday,The Dakota,Strawberry Fields,Foot,,,,0.1,,,,,,,,,,,,,,,,
21/11/2025,Friday,Strawberry Fields,Bethesda Fountain,Foot,,,,0.4,,,,,,,,,,,,,,,,
21/11/2025,Friday,Bethesda Fountain,Belvedere Castle,Foot,,,,0.4,,,,,,,,,,,,,,,,
21/11/2025,Friday,Belvedere Castle,Natural History Museum,Foot,,,,0.3,,,,,,,,,,,,,,,,
21/11/2025,Friday,Natural History Museum,Zabar's,Foot,,,,0.4,10am - 5:30pm,,,,,,,,,,,,,,,
21/11/2025,Friday,Zabar's,Washington Square Arch,Bike,,,,5.1,Midafternoon Snack,,,,,,,,,,,,,,,
21/11/2025,Friday,Washington Square Arch,90 Bedford St (Friends),Bike,,,,0.5,,,,,,,,,,,,,,,,
21/11/2025,Friday,90 Bedford St (Friends),The High Line,Bike,,,,0.7,,,,,,,,,,,,,,,,
21/11/2025,Friday,The High Line,The Vessel,Foot,,,,1.1,7am - 10pm,,,,,,,,,,,,,,,
21/11/2025,Friday,The Vessel,Skylight Diner (402W 34th St),Foot,,,,0.4,Dinner,,,,,,,,,,,,,,,
21/11/2025,Friday,Skylight Diner (402W 34th St),The Lexington,Subway,,,,2,6am - 11:30pm,,,,,,,,,,,,,,,
22/11/2025,Saturday,The Lexington,"The Garden People, Riverside Park",Subway,,,,3.3,,,,,,,,,,,,,,,,
22/11/2025,Saturday,"The Garden People, Riverside Park",You've Got Mail exterior (328w 89th st),Foot,,,,0.2,,,,,,,,,,,,,,,,
22/11/2025,Saturday,You've Got Mail exterior (328w 89th st),Belnord Apartments (Only Murders),Foot,,,,0.4,,,,,,,,,,,,,,,,
22/11/2025,Saturday,Belnord Apartments (Only Murders),Cafe Lalo (201W 83rd St),Foot,,,,0.2,,,,,,,,,,,,,,,,
22/11/2025,Saturday,Cafe Lalo (201W 83rd St),Gray's Papaya,Foot,,,,0.6,Lunch,,,,,,,,,,,,,,,
22/11/2025,Saturday,Gray's Papaya,The Lexington,Subway,,,,2.4,,,,,,,,,,,,,,,,
22/11/2025,Saturday,The Lexington,JFK Airport,Yellow Taxi,14:50,15:50,01:00,14.5,,,,,,,,,,,,,,,,
22/11/2025,Saturday,JFK Airport,Heathrow,Plane,18:50,06:45,06:55,3442,,,,,,,,,,,,,,,,
23/11/2025,Sunday,Heathrow,Poole,Car,07:45,09:45,02:00,95.7,,,,,,,,,,,,,,,,`;
                
                events = parseEventsFromCustomCSV(csvToRows(txt));
                grouped = groupByDate(events);
                allDates = Array.from(grouped.keys());
                allDates.sort((a, b) => {
                    const [da, ma, ya] = a.split('-').map(x => parseInt(x));
                    const [db, mb, yb] = b.split('-').map(x => parseInt(x));
                    return new Date(2000 + ya, ma - 1, da) - new Date(2000 + yb, mb - 1, db);
                });

                currentIndex = findTodayIndex();
                if(currentIndex === -1) currentIndex = 0;

                document.getElementById('prevBtn').addEventListener('click', () => {
                    if (currentIndex > 0) {
                        currentIndex--;
                        showItinerary();
                    }
                });

                document.getElementById('nextBtn').addEventListener('click', () => {
                    if (currentIndex < allDates.length - 1) {
                        currentIndex++;
                        showItinerary();
                    }
                });

                document.getElementById('todayBtn').addEventListener('click', () => {
                    const today = new Date();
                    const firstDate = new Date(`20${allDates[0].slice(-2)}`, allDates[0].slice(3, 5) - 1, allDates[0].slice(0, 2));
                    
                    if (today.getTime() < firstDate.getTime()) {
                        showCountdown();
                    } else {
                        const todayIndex = findTodayIndex();
                        if (todayIndex !== -1) {
                            currentIndex = todayIndex;
                        } else {
                            // If today's date is not in the itinerary but after the start, show the last known date.
                            currentIndex = allDates.length - 1;
                        }
                        showItinerary();
                    }
                });

                document.getElementById('backBtn').addEventListener('click', () => {
                    showItinerary();
                });

                // Initial render based on the current date
                const today = new Date();
                const firstDate = new Date(`20${allDates[0].slice(-2)}`, allDates[0].slice(3, 5) - 1, allDates[0].slice(0, 2));
                if (today.getTime() < firstDate.getTime()) {
                    showCountdown();
                } else {
                    showItinerary();
                }

            } catch (error) {
                console.error("Error loading itinerary:", error);
                document.getElementById('list').innerHTML = `<div class="empty">Error loading itinerary. Please check the file.</div>`;
            }
        }

        init();
    </script>
</body>
</html>
